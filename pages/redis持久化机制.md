- redis作为内存数据库，支持将数据持久化到磁盘。
  主要有两种持久化机制
- RDB持久化(快照 snapshotting)
  方案：通过创建快照来获得存储在内存里面的数据在某个时间点上的副本。将这个数据库状态保存到RDB文件中。
  快照持久化是 Redis 默认采用的持久化方式，在 redis.conf 配置文件中默认有此下配置：
  ```
  save 900 1           #在900秒(15分钟)之后，如果至少有1个key发生变化，Redis就会自动触发BGSAVE命令创建快照。
  
  save 300 10          #在300秒(5分钟)之后，如果至少有10个key发生变化，Redis就会自动触发BGSAVE命令创建快照。
  
  save 60 10000        #在60秒(1分钟)之后，如果至少有10000个key发生变化，Redis就会自动触发BGSAVE命令创建快照。
  ```
  RDB 文件保存位置都是通过 dir 参数设置的，默认的文件名是 dump.rdb。
  执行方式
  a。手动执行
  b。根据服务器配置选项定期执行
  RDB文件保存工作
  SAVE:SAVE命令会阻塞Redis服务器进程，直到RDB文件创建完毕为止，在服务器进程阻塞期间，服务器不能处理任何命令请求.
  BGSAVE:会派生出一个子进程，然后由子进程负责创建RDB文件，服务器进程（父进程）继续处理命令请求
  RDB文件的载入工作
  RDB文件的载入工作是在服务器启动时自动执行的，所以Redis并没有专门用于载入RDB文件的命令，只要Redis服务器在启动时检测到RDB文件存在，它就会自动载入RDB文件
- AOF持久化(只追加文件，append only file)
  方案：开启 AOF 持久化后每执行一条会更改 Redis 中的数据的命令，Redis 就会将该命令写入到内存缓存 server.aof_buf 中，然后再根据 appendfsync 配置来决定何时将其同步到硬盘中的 AOF 文件。
  与快照持久化相比
  AOF 持久化的实时性更好，因此已成为主流的持久化方案。
  默认情况下 Redis 没有开启 AOF（append only file）方式的持久化，可以通过 appendonly 参数开启：
  ```
  appendonly yes
  ```
  AOF 文件的保存位置和 RDB 文件的位置相同，都是通过 dir 参数设置的，默认的文件名是 appendonly.aof。
  AOF刷盘时机
  在 Redis 的配置文件中存在三种不同的 AOF 持久化方式，它们分别是：
  ```
  appendfsync always    #每次有数据修改发生时都会写入AOF文件,这样会严重降低Redis的速度
  appendfsync everysec  #每秒钟同步一次，显式地将多个写命令同步到硬盘
  appendfsync no        #让操作系统决定何时进行同步
  ```
  推荐参数选项：为了兼顾数据和写入性能，用户可以考虑 appendfsync everysec 选项 ，让 Redis 每秒同步一次 AOF 文件，Redis 性能几乎没受到任何影响。而且这样即使出现系统崩溃，用户最多只会丢失一秒之内产生的数据。当硬盘忙于执行写入操作的时候，Redis 还会优雅的放慢自己的速度以便适应硬盘的最大写入速度。
- AOF 重写
  目的:为了解决AOF文件体积膨胀的问题，Redis提供了AOF文件重写（rewrite）功能。
  Redis服务器可以创建一个新的AOF文件来替代现有的AOF文件，新旧两个AOF文件所保存的数据库状态相同，但新AOF文件不会包含任何浪费空间的冗余命令，
  好处:新AOF文件的体积通常会比旧AOF文件的体积要小得多。
  实现原理:
  AOF重写缓冲区
  在执行 BGREWRITEAOF 命令时，Redis 服务器会维护一个 AOF 重写缓冲区，该缓冲区会在子进程创建新 AOF 文件期间，记录服务器执行的所有写命令。当子进程完成创建新 AOF 文件的工作之后，服务器会将重写缓冲区中的所有内容追加到新 AOF 文件的末尾，使得新的 AOF 文件保存的数据库状态与现有的数据库状态一致。最后，服务器用新的 AOF 文件替换旧的 AOF 文件，以此来完成 AOF 文件重写操作。