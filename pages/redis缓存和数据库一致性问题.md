- 讨论问题的思路梳理
  缓存方案
  1. 缓存怎么存怎么读
  
  2. 缓存方案:
  a. 先更新cache再更新DB
  b. 先更新DB再更新cache
  c. 先删除cache再更新DB
  d. 先删除DB再删除cache
  
  3. 缓存问题:
  0. 根本性问题:数据不一致性问题
  a. 原子性问题:缓存方案中的第一步操作成功，但是第二步操作失败，有什么问题?
  b. 读写并发会有什么问题?
  c. 数据库主从复制延迟有什么问题
  
  缓存解决方案
  a. 为什么要引入消息队列保证一致性？
  b. 延迟双删会有什么问题？到底要不要用？
  ![image.png](../assets/image_1655892556285_0.png)
- 业务场景分析
  0. 最简单的场景开始讲起。
  如果你的业务处于起步阶段，流量非常小，那无论是读请求还是写请求，直接操作数据库即可，这时你的架构模型是这样的：
  ![image.png](../assets/image_1655892627894_0.png)
  10. 但随着业务量的增长，你的项目请求量越来越大，这时如果每次都从数据库中读数据，那肯定会有性能问题。
  这个阶段通常的做法是，引入「缓存」来提高读性能，架构模型就变成了这样：
  ![image.png](../assets/image_1655892738376_0.png)
  当下优秀的缓存中间件，当属 Redis 莫属，它不仅性能非常高，还提供了很多友好的数据类型，可以很好地满足我们的业务需求。
  20. 引入缓存之后，你就会面临一个问题：之前数据只存在数据库中，现在要放到缓存中读取，具体要怎么存呢？
  方案一:最简单直接的方案是「全量数据刷到缓存中」：
  a。数据库的数据，全量刷入缓存（不设置失效时间）
  b。写请求只更新数据库，不更新缓存
  c。启动一个定时任务，定时把数据库的数据，更新到缓存中
  
  ![image.png](../assets/image_1655899052145_0.png)
  这个方案的优点是，所有读请求都可以直接「命中」缓存，不需要再查数据库，性能非常高。
  但缺点也很明显，有 2 个问题：
  a。缓存利用率低：不经常访问的数据，还一直留在缓存中
  b。数据不一致问题：因为是「定时」刷新缓存，缓存和数据库存在不一致（取决于定时任务的执行频率）
  所以，这种方案一般更适合业务「体量小」，且对数据一致性要求不高的业务场景。
-
- 过程
  读写MySQL--->引入缓存提高性能--->引入问题:缓存怎么存怎么读
- 资料
  这篇强烈推荐
  [缓存和数据库一致性问题，看这篇就够了-水滴与银弹 ，作者Magic Kaito](https://mp.weixin.qq.com/s/D4Ik6lTA_ySBOyD3waNj1w)