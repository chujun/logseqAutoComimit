- MVCC机制
- InnoDB锁
	- 表级锁和行级锁
	  ((62a706f1-751d-47c8-821a-eba8ed64715c))
	- InnoDB行级锁三种实现
	  id:: 62a72634-9fbf-4ee5-b9c0-5f8ee7c1c786
	  行锁触发条件是命中索引，MySQL默认使用临键锁
		- 1. 记录锁（Record Lock） ：也被称为记录锁，属于单个行记录上的锁。
		  记录锁触发条件:查询条件命中索引
		- 2. 间隙锁（Gap Lock） ：又叫区间锁，锁定一个范围，不包括记录本身。
		  当我们查询数据用范围查询而不是相等条件查询时，**查询条件命中索引，并且没有查询到符合条件的记录**，此时就会将查询条件中的范围数据进行锁定(即使是范围库中不存在的数据也会被锁定)
		  间隙锁触发条件:查询条件命中索引，并且没有查询到符合条件的记录
		- 间隙锁特征
		  1. 间隙锁锁定区间范围是左开右闭区间
		  2. 间隙锁只会出现在可重复读的事务隔离级别中
		- 间隙锁作用示例:左开右闭区间
		  我们打开两个窗口，在窗口A中我们根据id做一个范围更改操作，不提交事务，然后在范围B中插入一条记录，该记录的id值位于窗口A中的条件范围内
		  ![image.png](../assets/image_1655121922806_0.png)
		  查看运行结果:上述代码中，所锁定的区间就是 (1,3]这个区间,不包含1，但是包含3，并且不包含4，也就是说间隙锁这里是左开右闭区间
		- 间隙锁特征实验:只会出现在可重复读的事务隔离级别中
		  首先将mysql数据库隔离级别修改为不可重复读
		  ```
		  //设置事务隔离级别为不可重复读
		  set session transaction isolation level read committed;
		  //查看当前事务级别
		  SELECT @@tx_isolation
		  ```
		  打开两个窗口，在窗口A中我们根据id做一个范围更改操作，不提交事务，然后在范围B中插入一条记录，该记录的id值位于窗口A中的条件范围内
		  ![image.png](../assets/image_1655122555564_0.png){:height 214, :width 698}
		  运行结果分析:修改了数据库隔离级别后，再次测试间隙锁，发现间隙锁没有生效。我们可以通过rollback回滚事务。
		- 3. 临键锁（Next-key Lock） ：Record Lock+Gap Lock，锁定一个范围，包含记录本身。记录锁只能锁住已经存在的记录，为了避免插入新记录，需要依赖间隙锁。
		  临键锁触发条件:查询条件命中索引,同时有匹配到数据库记录
		  特征:
		  临键锁是由记录锁和间隙锁共同实现的
		  临键锁锁定是当前记录的区间和下一个记录的区间.
		- 临键锁实验
		- InnoDB 的默认隔离级别 REPEATABLE-READ（可重读）是可以解决幻读问题发生的，主要有下面两种情况：
		  1. 快照读 ：由 MVCC 机制来保证不出现幻读。
		  2. 当前读 ： 使用 Next-Key Lock 进行加锁来保证不出现幻读。
-
- 资料
  [MySQL 8InnoDB 官方文档](https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html)
  书籍
  《MySQL 技术内幕 InnoDB 存储引擎》